// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.

import { APIResource } from '../core/resource';
import * as Shared from './shared';
import { Webhook } from 'standardwebhooks';

export class Webhooks extends APIResource {
  unwrap(
    body: string,
    { headers, key }: { headers: Record<string, string>; key?: string },
  ): UnwrapWebhookEvent {
    if (headers !== undefined) {
      const keyStr: string | null = key === undefined ? this._client.webhookKey : key;
      if (keyStr === null) throw new Error('Webhook key must not be null in order to unwrap');
      const wh = new Webhook(keyStr);
      wh.verify(body, headers);
    }
    return JSON.parse(body) as UnwrapWebhookEvent;
  }
}

export interface InvoiceCreatedWebhookEvent {
  /**
   * A unique ID for every single webhook request
   */
  id?: string;

  /**
   * The API version for this webhook
   */
  api_version?: 'v1';

  /**
   * The timestamp in seconds since the Unix epoch that the webhook was sent at on
   * the server
   */
  created_at?: string;

  /**
   * A statement that defines an amount due by a customer.
   */
  data?: Shared.Invoice | null;

  /**
   * The webhook event type
   */
  type?: 'invoice.created';
}

export interface InvoicePaidWebhookEvent {
  /**
   * A unique ID for every single webhook request
   */
  id?: string;

  /**
   * The API version for this webhook
   */
  api_version?: 'v1';

  /**
   * The timestamp in seconds since the Unix epoch that the webhook was sent at on
   * the server
   */
  created_at?: string;

  /**
   * A statement that defines an amount due by a customer.
   */
  data?: Shared.Invoice | null;

  /**
   * The webhook event type
   */
  type?: 'invoice.paid';
}

export interface InvoicePastDueWebhookEvent {
  /**
   * A unique ID for every single webhook request
   */
  id?: string;

  /**
   * The API version for this webhook
   */
  api_version?: 'v1';

  /**
   * The timestamp in seconds since the Unix epoch that the webhook was sent at on
   * the server
   */
  created_at?: string;

  /**
   * A statement that defines an amount due by a customer.
   */
  data?: Shared.Invoice | null;

  /**
   * The webhook event type
   */
  type?: 'invoice.past_due';
}

export interface InvoiceVoidedWebhookEvent {
  /**
   * A unique ID for every single webhook request
   */
  id?: string;

  /**
   * The API version for this webhook
   */
  api_version?: 'v1';

  /**
   * The timestamp in seconds since the Unix epoch that the webhook was sent at on
   * the server
   */
  created_at?: string;

  /**
   * A statement that defines an amount due by a customer.
   */
  data?: Shared.Invoice | null;

  /**
   * The webhook event type
   */
  type?: 'invoice.voided';
}

export type UnwrapWebhookEvent =
  | InvoiceCreatedWebhookEvent
  | InvoicePaidWebhookEvent
  | InvoicePastDueWebhookEvent
  | InvoiceVoidedWebhookEvent;

export declare namespace Webhooks {
  export {
    type InvoiceCreatedWebhookEvent as InvoiceCreatedWebhookEvent,
    type InvoicePaidWebhookEvent as InvoicePaidWebhookEvent,
    type InvoicePastDueWebhookEvent as InvoicePastDueWebhookEvent,
    type InvoiceVoidedWebhookEvent as InvoiceVoidedWebhookEvent,
    type UnwrapWebhookEvent as UnwrapWebhookEvent,
  };
}
